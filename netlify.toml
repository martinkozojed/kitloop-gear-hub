[build]
  command = "export VITE_COMMIT_SHA=${COMMIT_SHA:-${COMMIT_REF:-unknown}} && export VITE_BUILD_TIME=$(date -u +\"%Y-%m-%dT%H:%M:%SZ\") && npm run build"
  publish = "dist"

[build.environment]
  NODE_VERSION = "20"

[context.production]
  command = "export VITE_COMMIT_SHA=${COMMIT_SHA:-${COMMIT_REF:-unknown}} && export VITE_BUILD_TIME=$(date -u +\"%Y-%m-%dT%H:%M:%SZ\") && npm run build"

[[plugins]]
  package = "./netlify/plugins/build-meta-plugin"

[[headers]]
for = "/*"
  [headers.values]
  Content-Security-Policy = "default-src 'self'; img-src 'self' data: https:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; script-src 'self' https://cdn.gpteng.co https://js.stripe.com; connect-src 'self' https://*.supabase.co https://api.stripe.com https://r.stripe.com https://*.sentry.io https://*.ingest.sentry.io http://127.0.0.1:54321 ws://127.0.0.1:54321; frame-src 'self' https://js.stripe.com; frame-ancestors 'self'; base-uri 'self';"
  Referrer-Policy = "no-referrer"
  Permissions-Policy = "geolocation=(), camera=(), microphone=()"
  X-Content-Type-Options = "nosniff"
  X-Frame-Options = "SAMEORIGIN"

# Context: Protect outbound requests to Supabase, Stripe, and Sentry (M1 hardening).
# To enable Stripe Elements later, extend script-src/frame-src with https://js.stripe.com
# Example variant: script-src 'self' https://js.stripe.com; frame-src 'self' https://js.stripe.com
# Keep connect-src ready for https://r.stripe.com (Stripe) and https://*.ingest.sentry.io (Sentry ingest).
